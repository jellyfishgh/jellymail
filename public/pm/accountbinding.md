# 手游绑定多益通帐号

## 需求说明

手游角色绑定多益通帐号后,可以获取到战盟的好友关系.

为实现手游快速便捷的绑定多益通帐号,战盟 app 提供一套标准的绑定流程和实现方案.

`iOS 手游` 与 `战盟 iOS` 使用 url 传递数据, `Android 手游` 与 `战盟 Android` 使用 sdk 传递数据.

如果本地没有安装 战盟 app 时,则手游界面上点击绑定按钮时使用内嵌浏览器访问 h5 页面,让玩家手动输入多益通帐号和密码,通过验证后实现绑定.

手游要实现解除绑定时,手游跟手游服自行通讯实现;要实现切换绑定的帐号时,重新走一步绑定的流程即可.

## 实现流程

### 已安装 app

![数据流转图](http://7xq0r0.com1.z0.glb.clouddn.com/api0.png)

1.手游上点击绑定按钮时向 app 传递自己的游戏代号和角色id(不一定是角色id,是手游服跟手游通讯时使用的id),app 跳转到授权界面上;

2.app授权界面上显示游戏名称,icon,返回和确认按钮;其中app 本地维护游戏代号对应的游戏名称和icon,如果没有的话就去服务端请求并保存在本地;点击返回按钮时直接返回到手游,点击确认时app向IM服请求时附带上游戏代号和角色id并等待服务端响应;

3.IM服向手游服请求时附带上帐号和角色id,手游服收到请求后执行绑定操作;

4.手游服绑定成功后向IM服响应绑定成功;

5.IM服收到绑定成功后向app响应绑定成功;

6.IM服收到响应成功后弹出提示"绑定成功"并返回到手游;

### 未安装 app

![数据流转图](http://7xq0r0.com1.z0.glb.clouddn.com/api.png)

1.当前设备上未安装战盟app,手游上点击绑定按钮时用内置浏览器访问h5页面并传递手游的代号和当前使用的角色id(不一定是角色id,是手游服区分不同手游帐号时使用的id);

2.玩家在h5页面上输入多益通帐号和密码,点击提交后web服根据游戏代号去向对应的游戏服请求并附带上角色id和多益通帐号;

3.手游服收到请求后执行绑定帐号的操作,操作成功后手游服告诉手游绑定的帐号并且给web服响应绑定成功;

4.web服收到绑定成功后通知后告诉h5前端页面绑定成功,h5前端弹出绑定成功的提示并关闭页面;

## 待确认的问题

1.app 是否需要向手游返回帐号信息?因为手游服绑定成了可以直接告诉手游

2.h5 前端页面关闭时是否需要向手游传递帐号信息?因为手游服绑定成功了可以直接告诉手游

3.IM服和web服向手游服请求绑定时是否调用同一个接口?