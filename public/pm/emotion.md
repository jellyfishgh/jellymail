
---
title: 自定义表情
date: 2016-03-22 15:22:40
tags: 表情
---

# 一.服务端

[TOC]

## 1.聊天

新增“自定义表情”消息类型，在线下发和离线推送时客户端在消息界面显示为“[表情]”；

服务端不进行压缩客户端上传的图片，只进行转发；

## 2.同步漫游

### 2.1.在线漫游

同一个帐号在线的所有客户端，即时下发新增或者删除的通知；

### 2.2.登录下发

登录时根据时间判断当前客户端是否为最新，不为最新时全量下发；

# 二.客户端

## 1.发送

点击自定义表情栏中的表情后立即发送不停留在聊天框中；

## 2.显示

### 2.1.<span style="color:red;">PC端</span>

### 2.2.移动端

发送和接收后显示时不加气泡；

## 3.添加

个数限制为100个，添加时向服务端请求：如果服务端返回个数已满则客户端弹出泡泡提示“你最多只能收藏X个表情”；请求超时30s，如果超时或者其他异常，则弹出泡泡提示“添加失败”；

### 3.1.本地添加

#### 3.1.1.gif

添加时判断gif的大小，如果>=1M则提示“图片过大，无法添加”；

添加的gif根据客户端是否有能力压缩gif来选择是否压缩；

#### 3.1.1.非gif

添加后客户端进行压缩，然后上传压缩过的图片给服务端；
压缩规则同现有**图片缩略图**生成规则，如各端现在不统一则统一按照以下**压缩规则**进行压缩；

    a.一般图片；
    b.长图：h/w > 3；
    c.全景图：h/w < 0.45；

    一般图片：成比例压缩，宽与高最大值为120；宽高都小于120，不进行压缩；
    长图：图片上边缘为起点，截取 H(H = 1.76*图片宽度) 图片高度进行压缩，压缩规则同1；
    全景图：图片左边缘为起点，截取 W(W = 1.76*图片高度) 图片宽度进行压缩，压缩规则同1；



### 3.2.聊天消息中添加

3.2.1.<span style="color:red;">PC端</span>

3.2.1.移动端

长按“自定义表情”类型的消息气泡时，如果本地没有该表情则菜单项中包含“添加到表情”；

预览图片时，如果本地没有该图片对应的表情，那么长按后弹出菜单项中应该包含“添加到表情”；添加时的限制和压缩规则同3.1；

## 4.操作及限制

### 2.1.<span style="color:red;">PC端</span>

### 2.2.移动端

预览表情时，如果本地没有则长按时菜单项中包含“添加到表情”，长按后的菜单项中需要包含“发送给战友”；